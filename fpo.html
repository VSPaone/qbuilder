<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Portfolio Optimization - 8-Step Gate-by-Gate (Compare with Table)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]']] },
      options: { renderActions: { addMenu: [] } }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <style>
    :root{
      --bg:#ffffff;--fg:#0f172a;--muted:#475569;--accent:#0f766e;--card:#f8fafc;--border:#e2e8f0;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      --sans: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    html,body{background:var(--bg);color:var(--fg);margin:0}
    body{font:16px/1.6 var(--sans);padding:24px}
    header{max-width:1000px;display:flex;gap:12px;align-items:center;justify-content:space-between;margin:0 auto;margin-bottom:16px}
    h1{font:800 28px/1.2 var(--sans);margin:0 0 6px}
    .sub{color:var(--muted)}
    .actions button{background:var(--accent);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .actions button:hover{filter:brightness(.95)}
    main{max-width:1000px;margin:0 auto}
    section.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;margin:16px 0}
    h2{font:700 22px/1.25 var(--sans);margin:0 0 10px}
    h3{font:700 18px/1.35 var(--sans);margin:18px 0 6px}
    .note{color:var(--muted);font-style:italic}
    .eq{background:#fff;border:1px dashed var(--border);border-radius:10px;padding:10px 12px;overflow-x:auto}
    .mono{font-family:var(--mono)}
    table{width:100%;border-collapse:collapse;margin:12px 0}
    th,td{padding:8px 10px;border-bottom:1px solid var(--border);vertical-align:top}
    th{background:#eef2ff;text-align:left}
    .step-head{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{background:#111827;color:#e5e7eb;border-radius:999px;padding:2px 10px;font:600 12px var(--sans)}
    .grid{display:grid;grid-template-columns:180px 1fr;gap:14px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    .journey{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;overflow-x:auto}
    @media print{header .actions{display:none} body{padding:0} section.card{break-inside:avoid}}
  </style>
</head>
<body>
  <header>
    <div>
      <div class="sub">Handout • Compare step-by-step with the 8-row table</div>
      <h1>Finance Portfolio Optimization - 8-Step Gate-by-Gate (2 Assets)</h1>
      <div class="note">Choice register \(X=(q_1\,q_0)\); scratch counters \(C_{\text{budget}}, C_{\text{risk}}\); flag \(F\); ancillas \(A\).</div>
    </div>
    <div class="actions">
      <button onclick="window.print()">Print / Save as PDF</button>
    </div>
  </header>

  <main>
    <!-- Overview & Setup -->
    <section class="card">
      <h2>Notation & Setup (small realistic instance)</h2>
      <div class="grid">
        <div><strong>Amplitude vector on X</strong></div>
        <div class="eq">\( (a_{00}, a_{01}, a_{10}, a_{11}) \) for \( |00\rangle,|01\rangle,|10\rangle,|11\rangle \).</div>

        <div><strong>Assets</strong></div>
        <div class="eq">Costs \(c=[3,2]\), Returns \(r=[5,4]\), Budget \(B=3\).</div>

        <div><strong>Portfolios</strong></div>
        <div>
          <table>
            <thead><tr><th>\(x_1x_0\)</th><th>Pick</th><th>Cost</th><th>Feasible?</th><th>Return</th></tr></thead>
            <tbody>
              <tr><td class="mono">00</td><td>none</td><td>0</td><td>✓</td><td>0</td></tr>
              <tr><td class="mono">01</td><td>{A<sub>0</sub>}</td><td>3</td><td>✓</td><td>5</td></tr>
              <tr><td class="mono">10</td><td>{A<sub>1</sub>}</td><td>2</td><td>✓</td><td>4</td></tr>
              <tr><td class="mono">11</td><td>{A<sub>0</sub>,A<sub>1</sub>}</td><td>5</td><td>✗ overflow</td><td>9</td></tr>
            </tbody>
          </table>
          <p><strong>Hard target:</strong> “best feasible” is \(|01\rangle\) (max return under budget).</p>
        </div>
      </div>
    </section>

    <!-- Step table (for immediate visual comparison) -->
    <section class="card">
      <h2>Reference: The 8-Step Recipe (as in your table)</h2>
      <table>
        <thead><tr><th>Step</th><th>Registers</th><th>Gates (what they do)</th><th>Effect / Why here</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>X</td><td>H on all X</td><td>Create hypotheses (superposition of pick/skip portfolios).</td></tr>
          <tr><td>2</td><td>X → \(C_{\text{budget}}\)</td><td>CNOT + Toffoli adders</td><td>Add picked costs reversibly to budget counter.</td></tr>
          <tr><td>3</td><td>pairs(X) → \(C_{\text{risk}}\)</td><td>CZ mesh + add</td><td>When correlated assets chosen, add risk penalty.</td></tr>
          <tr><td>4</td><td>F</td><td>controlled-\( \mathrm{RY}(\theta) \)</td><td>Map score (return↑, risk↓) to keep-angle on \(F\) (soft bias).</td></tr>
          <tr><td>5</td><td>F in \(|-\rangle\)</td><td>phase kickback on overflow</td><td>If \(C_{\text{budget}}>B\), flip phase (hard penalty).</td></tr>
          <tr><td>6</td><td>C and A</td><td>uncompute</td><td>Clean workspace; leave only phase/flag on X,F.</td></tr>
          <tr><td>7 (opt.)</td><td>X</td><td>H–Z–H mirror</td><td>Light reflection magnifies phase-tagged winners.</td></tr>
          <tr><td>8</td><td>F, X</td><td>measure</td><td>Keep runs with \(F{=}1\); read X as portfolio.</td></tr>
        </tbody>
      </table>
    </section>

    <!-- STEP 1 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 1</span><h2>H on all X - create hypotheses</h2></div>
      <p>Apply \(H\) on both choice qubits \((H^{\otimes 2})\) starting from \(|00\rangle\).</p>
      <div class="eq">State on X: \( (1,0,0,0) \;\to\; (0.5,\,0.5,\,0.5,\,0.5) \).</div>
      <p class="note">All four portfolios now have equal amplitude.</p>
    </section>

    <!-- STEP 2 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 2</span><h2>Compute budget - reversible adders</h2></div>
      <p>For each asset \(i\), if \(x_i{=}1\) then <em>add</em> cost \(c_i\) into \(C_{\text{budget}}\) using CNOT/Toffoli adders.</p>
      <div class="eq">This updates counters but <strong>does not change</strong> amplitudes on X.</div>
      <p class="note">Counters let us test overflow later without collapsing superposition.</p>
    </section>

    <!-- STEP 3 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 3</span><h2>Compute risk - CZ mesh + add</h2></div>
      <p>For correlated pairs (here just the pair \(A_0\!\leftrightarrow\!A_1\)), use CZ to detect \(x_0{=}x_1{=}1\) and add a penalty into \(C_{\text{risk}}\).</p>
      <div class="eq">Again, amplitudes on X stay the same; only counters/ancillas change.</div>
      <p class="note">Entanglement shares “both selected” information without measuring X.</p>
    </section>

    <!-- STEP 4 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 4</span><h2>Soft bias - controlled-\( \mathrm{RY}(\theta(x)) \) on \(F\)</h2></div>
      <p>Define a score \( s(x)=\alpha\,\text{return}(x)-\beta\,\text{risk}(x)-\gamma\,\text{overflow}(x) \). Rotate the flag qubit \(F\) by</p>
      <div class="eq">\( \mathrm{RY}(\,\theta(x)\,) \quad \text{with} \quad \theta(x)=\kappa\cdot s(x) \)</div>
      <p>controlled on the computed counters (so each portfolio \(x\) has its own angle). This makes \(F{=}1\) more likely for good portfolios.</p>
      <p class="note">This step <em>biases sampling</em> without changing X’s relative phases yet.</p>
    </section>

    <!-- STEP 5 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 5</span><h2>Hard penalty - phase kickback on overflow</h2></div>
      <p>Prepare an ancilla in \(|-\rangle=(|0\rangle-|1\rangle)/\sqrt{2}\). If \(C_{\text{budget}}>B\) (overflow), perform a controlled-Z onto that ancilla.</p>
      <div class="eq">Kickback adds a global <strong>phase \(-1\)</strong> to all infeasible branches (those with overflow), leaving feasible ones untouched.</div>
      <p class="note">This is the “oracle-like” hard mark that Grover needs.</p>
    </section>

    <!-- STEP 6 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 6</span><h2>Uncompute C and A - keep interference clean</h2></div>
      <p>Reverse the adders and CZ-mesh so that \(C_{\text{budget}}, C_{\text{risk}}\) and temporary ancillas return to \(|0\cdots0\rangle\).</p>
      <div class="eq">Only effects remaining on the computational path: (i) the overflow phase on X, (ii) bias amplitude on \(F\).</div>
      <p class="note">Uncomputing removes garbage that would otherwise spoil interference.</p>
    </section>

    <!-- STEP 7 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 7 (optional)</span><h2>Grover mirror on X - reflect to amplify</h2></div>
      <p>Apply the reflection (diffuser) on X to magnify the phase-tagged winners. For 2 qubits we can use the standard sequence:</p>
      <div class="eq mono">H(q0), H(q1) → X(q0), X(q1) → CZ(q1,q0) → X(q0), X(q1) → H(q0), H(q1)</div>
      <p class="note">The table’s “H–Z–H” shorthand indicates a reflection; for 2-qubit demos the above diffuser is the explicit version students can map to gates.</p>
      <div class="journey mono">
        Example (hard mark set to \(|01\rangle\)):<br/>
        \[
          (0.5,0.5,0.5,0.5)
          \xrightarrow{\text{oracle hard phase on }|01\rangle}
          (0.5,-0.5,0.5,0.5)
          \xrightarrow{\text{diffuser}}
          (0,1,0,0)
        \]
      </div>
    </section>

    <!-- STEP 8 -->
    <section class="card">
      <div class="step-head"><span class="pill">Step 8</span><h2>Measure F and X - interpret the outcome</h2></div>
      <p>Measure \(F\) and X. Two simple classroom modes:</p>
      <ul>
        <li><strong>Keep-\(F\)</strong>: condition on \(F{=}1\) (accept-reject). Reads X only when the soft bias endorses the pick.</li>
        <li><strong>Plain Grover</strong>: ignore \(F\) and just read X; the hard mark + diffuser drive samples toward feasible best portfolios.</li>
      </ul>
      <div class="eq">For our toy instance with a hard mark at \(|01\rangle\): \( P(|01\rangle)=1 \) (ideal math), others \(=0\).</div>
      <p class="note">With larger assets and softer scores, probabilities concentrate rather than collapse; increase shots to see stable frequencies.</p>
    </section>

    <!-- Appendix: Quick one-line summary -->
    <section class="card">
      <h2>One-line journey (hard mark example)</h2>
      <div class="journey mono">
        \[
        |00\rangle \xrightarrow{H,H}
        (0.5,0.5,0.5,0.5)
        \xrightarrow{\text{compute }C_{\text{budget}},C_{\text{risk}}}
        (0.5,0.5,0.5,0.5)
        \xrightarrow{\text{soft } \mathrm{RY}(\theta(x)) \text{ on }F}
        (0.5,0.5,0.5,0.5)
        \xrightarrow{\text{hard overflow phase on X}}
        (0.5,-0.5,0.5,0.5)
        \xrightarrow{\text{uncompute}}
        (0.5,-0.5,0.5,0.5)
        \xrightarrow{\text{diffuser}}
        (0,1,0,0)
        \]
      </div>
    </section>
  </main>
</body>
</html>
